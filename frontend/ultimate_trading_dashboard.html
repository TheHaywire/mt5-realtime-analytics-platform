<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate MT5 Trading Intelligence Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', sans-serif; 
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a3e 25%, #2d1b69 50%, #4338ca 75%, #6366f1 100%); 
            color: #e2e8f0; 
            min-height: 100vh;
            overflow-x: hidden;
        }
        .glass { 
            background: rgba(255, 255, 255, 0.1); 
            backdrop-filter: blur(15px); 
            border: 1px solid rgba(255, 255, 255, 0.2); 
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        .glow { box-shadow: 0 0 20px rgba(99, 102, 241, 0.3); }
        .profit { color: #10b981; text-shadow: 0 0 10px rgba(16, 185, 129, 0.3); }
        .loss { color: #ef4444; text-shadow: 0 0 10px rgba(239, 68, 68, 0.3); }
        .neutral { color: #64748b; }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }
        
        /* Enhanced animations */
        .slide-in { animation: slideInFromLeft 0.5s ease-out; }
        @keyframes slideInFromLeft { from { transform: translateX(-100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        
        .fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        .scale-in { animation: scaleIn 0.3s ease-out; }
        @keyframes scaleIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        
        /* Cards */
        .card { 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
            cursor: pointer;
        }
        .card:hover { 
            transform: translateY(-8px) scale(1.02); 
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
        }
        
        /* Alert priority colors */
        .alert-critical { border-left: 4px solid #dc2626; background: linear-gradient(90deg, rgba(220, 38, 38, 0.2), rgba(220, 38, 38, 0.05)); }
        .alert-high { border-left: 4px solid #ea580c; background: linear-gradient(90deg, rgba(234, 88, 12, 0.2), rgba(234, 88, 12, 0.05)); }
        .alert-medium { border-left: 4px solid #ca8a04; background: linear-gradient(90deg, rgba(202, 138, 4, 0.2), rgba(202, 138, 4, 0.05)); }
        .alert-low { border-left: 4px solid #059669; background: linear-gradient(90deg, rgba(5, 150, 105, 0.2), rgba(5, 150, 105, 0.05)); }
        
        /* Pattern validation indicators */
        .pattern-validated { border: 2px solid #10b981; background: rgba(16, 185, 129, 0.1); }
        .pattern-pending { border: 2px solid #f59e0b; background: rgba(245, 158, 11, 0.1); }
        
        /* Performance indicators */
        .performance-excellent { background: linear-gradient(135deg, #059669, #10b981); }
        .performance-good { background: linear-gradient(135deg, #0891b2, #06b6d4); }
        .performance-average { background: linear-gradient(135deg, #ca8a04, #f59e0b); }
        .performance-poor { background: linear-gradient(135deg, #dc2626, #ef4444); }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.1); }
        ::-webkit-scrollbar-thumb { 
            background: linear-gradient(180deg, #6366f1, #8b5cf6); 
            border-radius: 10px; 
        }
        ::-webkit-scrollbar-thumb:hover { background: linear-gradient(180deg, #4f46e5, #7c3aed); }
    </style>
</head>
<body>
    <!-- Floating Status Bar -->
    <div class="fixed top-4 right-4 z-50 glass p-3 text-sm">
        <div class="flex items-center space-x-2">
            <div class="pulse w-2 h-2 bg-green-400 rounded-full"></div>
            <span id="status-indicator">LIVE INTELLIGENCE</span>
            <span class="text-white/60">|</span>
            <span id="data-rate" class="text-green-400">0 msg/min</span>
        </div>
    </div>

    <!-- Header -->
    <header class="glass m-4 p-6 glow">
        <div class="flex justify-between items-center">
            <div class="flex items-center space-x-6">
                <h1 class="text-4xl font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent">
                    Ultimate Trading Intelligence
                </h1>
                <div class="text-sm text-white/70">
                    <div>Real-time MT5 Analytics Platform</div>
                    <div class="text-xs">Statistical ‚Ä¢ Strategic ‚Ä¢ Predictive</div>
                </div>
            </div>
            <div class="text-right">
                <div class="text-2xl font-bold text-white" id="account-balance">$---.--</div>
                <div class="text-white/60" id="account-info">Connecting...</div>
                <div class="text-xs text-white/50" id="server-time">Loading...</div>
            </div>
        </div>
    </header>

    <div class="max-w-7xl mx-auto px-4 space-y-6">
        
        <!-- Intelligence Summary Dashboard -->
        <div class="glass p-6 glow">
            <h2 class="text-2xl font-bold text-white mb-6 flex items-center">
                <span class="mr-3">üß†</span>Intelligence Command Center
            </h2>
            <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
                <div class="text-center p-4 glass">
                    <div class="text-3xl font-bold profit" id="active-edges">0</div>
                    <div class="text-xs text-white/70">Active Edges</div>
                </div>
                <div class="text-center p-4 glass">
                    <div class="text-3xl font-bold text-blue-400" id="strategy-signals">0</div>
                    <div class="text-xs text-white/70">Strategy Signals</div>
                </div>
                <div class="text-center p-4 glass">
                    <div class="text-3xl font-bold text-purple-400" id="live-alerts">0</div>
                    <div class="text-xs text-white/70">Live Alerts</div>
                </div>
                <div class="text-center p-4 glass">
                    <div class="text-3xl font-bold text-yellow-400" id="patterns-discovered">0</div>
                    <div class="text-xs text-white/70">Patterns Found</div>
                </div>
                <div class="text-center p-4 glass">
                    <div class="text-3xl font-bold text-green-400" id="avg-confidence">0%</div>
                    <div class="text-xs text-white/70">Avg Confidence</div>
                </div>
                <div class="text-center p-4 glass">
                    <div class="text-3xl font-bold text-red-400" id="risk-level">MED</div>
                    <div class="text-xs text-white/70">Risk Level</div>
                </div>
            </div>
        </div>

        <!-- Critical Alerts Banner -->
        <div id="critical-alerts-banner" class="hidden glass p-4 border-l-4 border-red-500 bg-red-500/10 fade-in">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <span class="text-2xl">üö®</span>
                    <div>
                        <div class="font-bold text-red-400">Critical Trading Alert</div>
                        <div class="text-sm text-white/80" id="critical-alert-message"></div>
                    </div>
                </div>
                <button onclick="dismissCriticalAlert()" class="text-white/60 hover:text-white text-xl">&times;</button>
            </div>
        </div>

        <!-- Live Trading Signals -->
        <div class="glass p-6">
            <h2 class="text-xl font-bold text-white mb-4 flex items-center">
                <span class="mr-2">üéØ</span>Live Trading Signals
                <span class="ml-2 px-2 py-1 bg-green-500/20 text-green-400 text-xs rounded-full" id="signal-count">0</span>
            </h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4" id="live-signals">
                <div class="text-white/60 text-center py-8 col-span-2">Monitoring for high-confidence opportunities...</div>
            </div>
        </div>

        <!-- Strategy Performance Matrix -->
        <div class="glass p-6">
            <h2 class="text-xl font-bold text-white mb-4 flex items-center">
                <span class="mr-2">üèÜ</span>Strategy Performance Matrix
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4" id="strategy-matrix">
                <!-- Strategy cards populated here -->
            </div>
        </div>

        <!-- Advanced Analytics Dashboard -->
        <div class="grid grid-cols-1 xl:grid-cols-2 gap-6">
            
            <!-- Statistical Edges & Patterns -->
            <div class="glass p-6">
                <h3 class="text-lg font-bold text-white mb-4 flex items-center">
                    <span class="mr-2">‚ö°</span>Statistical Edge Analysis
                </h3>
                <div class="space-y-3 max-h-80 overflow-y-auto" id="statistical-analysis">
                    <div class="text-white/60 text-center py-8">Running statistical analysis...</div>
                </div>
            </div>

            <!-- Pattern Recognition -->
            <div class="glass p-6">
                <h3 class="text-lg font-bold text-white mb-4 flex items-center">
                    <span class="mr-2">üîç</span>AI Pattern Discovery
                </h3>
                <div class="space-y-3 max-h-80 overflow-y-auto" id="pattern-discovery">
                    <div class="text-white/60 text-center py-8">ML engines analyzing patterns...</div>
                </div>
            </div>

        </div>

        <!-- Market Intelligence Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
            
            <!-- Market Regime -->
            <div class="glass p-6 card">
                <h4 class="font-bold text-white mb-3 flex items-center">
                    <span class="mr-2">üìä</span>Market Regime
                </h4>
                <div class="text-center">
                    <div class="text-2xl font-bold text-white mb-2" id="market-regime">Analyzing</div>
                    <div class="text-xs text-white/60" id="regime-confidence"></div>
                </div>
            </div>

            <!-- Volatility Monitor -->
            <div class="glass p-6 card">
                <h4 class="font-bold text-white mb-3 flex items-center">
                    <span class="mr-2">üìà</span>Volatility
                </h4>
                <div class="text-center">
                    <div class="text-2xl font-bold text-white mb-2" id="volatility-status">Normal</div>
                    <div class="text-xs text-white/60" id="volatility-details"></div>
                </div>
            </div>

            <!-- Session Analysis -->
            <div class="glass p-6 card">
                <h4 class="font-bold text-white mb-3 flex items-center">
                    <span class="mr-2">üåç</span>Session
                </h4>
                <div class="text-center">
                    <div class="text-2xl font-bold text-white mb-2" id="current-session">Loading</div>
                    <div class="text-xs text-white/60" id="session-details"></div>
                </div>
            </div>

            <!-- Opportunity Score -->
            <div class="glass p-6 card">
                <h4 class="font-bold text-white mb-3 flex items-center">
                    <span class="mr-2">üéØ</span>Opportunity
                </h4>
                <div class="text-center">
                    <div class="text-2xl font-bold profit mb-2" id="opportunity-score">--</div>
                    <div class="text-xs text-white/60">Real-time Score</div>
                </div>
            </div>

        </div>

        <!-- Live Market Data with Enhanced Visualization -->
        <div class="glass p-6">
            <h3 class="text-lg font-bold text-white mb-4 flex items-center">
                <span class="mr-2">üî¥</span>Live Market Feed
                <span class="ml-auto text-xs text-white/60" id="feed-status">Streaming...</span>
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="glass p-4 card">
                    <div class="flex justify-between items-start mb-3">
                        <div class="text-yellow-400 font-bold">GOLD/USD</div>
                        <div class="text-xs text-white/60" id="gold-trend">üìà</div>
                    </div>
                    <div class="text-white text-3xl font-bold mb-2" id="gold-price">$---.--</div>
                    <div class="text-yellow-300 text-sm mb-2" id="gold-spread">Spread: ---</div>
                    <div class="text-xs text-white/60" id="gold-change">Change: ---</div>
                </div>
                
                <div class="glass p-4 card">
                    <div class="flex justify-between items-start mb-3">
                        <div class="text-blue-400 font-bold">EUR/USD</div>
                        <div class="text-xs text-white/60" id="eur-trend">üìä</div>
                    </div>
                    <div class="text-white text-3xl font-bold mb-2" id="eur-price">-.-----</div>
                    <div class="text-blue-300 text-sm mb-2" id="eur-spread">Spread: --- pips</div>
                    <div class="text-xs text-white/60" id="eur-change">Change: ---</div>
                </div>
                
                <div class="glass p-4 card">
                    <div class="flex justify-between items-start mb-3">
                        <div class="text-purple-400 font-bold">GBP/USD</div>
                        <div class="text-xs text-white/60" id="gbp-trend">üìâ</div>
                    </div>
                    <div class="text-white text-3xl font-bold mb-2" id="gbp-price">-.-----</div>
                    <div class="text-purple-300 text-sm mb-2" id="gbp-spread">Spread: --- pips</div>
                    <div class="text-xs text-white/60" id="gbp-change">Change: ---</div>
                </div>
            </div>
        </div>

    </div>

    <script>
        let ws = null;
        let messageCount = 0;
        let startTime = Date.now();
        let lastPrices = { gold: 0, eur: 0, gbp: 0 };
        let lastData = {};

        function connectWebSocket() {
            if (ws) ws.close();
            
            ws = new WebSocket('ws://localhost:8000/ws/live-data');
            
            ws.onopen = () => {
                document.getElementById('status-indicator').textContent = 'LIVE INTELLIGENCE';
                console.log('üöÄ Ultimate dashboard connected');
            };
            
            ws.onmessage = (event) => {
                try {
                    const data = JSON.parse(event.data);
                    messageCount++;
                    updateUltimateDashboard(data);
                    updateDataRate();
                } catch (e) {
                    console.error('Ultimate dashboard error:', e);
                }
            };
            
            ws.onclose = () => {
                document.getElementById('status-indicator').textContent = 'RECONNECTING...';
                setTimeout(connectWebSocket, 3000);
            };
        }

        function updateUltimateDashboard(data) {
            lastData = data;
            
            // Update all sections
            updateServerTime();
            updateMarketData(data);
            updateIntelligenceSummary(data);
            updateLiveSignals(data);
            updateStrategyMatrix(data);
            updateStatisticalAnalysis(data);
            updatePatternDiscovery(data);
            updateMarketIntelligence(data);
            updateCriticalAlerts(data);
        }

        function updateServerTime() {
            document.getElementById('server-time').textContent = new Date().toLocaleTimeString();
        }

        function updateDataRate() {
            const minutesElapsed = (Date.now() - startTime) / 60000;
            const rate = minutesElapsed > 0 ? Math.round(messageCount / minutesElapsed) : 0;
            document.getElementById('data-rate').textContent = `${rate} msg/min`;
        }

        function updateMarketData(data) {
            if (!data.live_rates) return;

            // GOLD
            const gold = data.live_rates.GOLD || data.live_rates.XAUUSD;
            if (gold) {
                const change = lastPrices.gold ? gold.bid - lastPrices.gold : 0;
                const trend = change > 0 ? 'üìà' : change < 0 ? 'üìâ' : '‚û°Ô∏è';
                
                document.getElementById('gold-price').textContent = `$${gold.bid.toFixed(2)}`;
                document.getElementById('gold-spread').textContent = `Spread: ${gold.spread?.toFixed(2)}`;
                document.getElementById('gold-change').textContent = `Change: ${change >= 0 ? '+' : ''}${change.toFixed(2)}`;
                document.getElementById('gold-trend').textContent = trend;
                
                lastPrices.gold = gold.bid;
            }

            // EUR/USD
            const eur = data.live_rates.EURUSD;
            if (eur) {
                const change = lastPrices.eur ? eur.bid - lastPrices.eur : 0;
                const trend = change > 0 ? 'üìà' : change < 0 ? 'üìâ' : '‚û°Ô∏è';
                
                document.getElementById('eur-price').textContent = eur.bid.toFixed(5);
                document.getElementById('eur-spread').textContent = `Spread: ${(eur.spread * 10000).toFixed(1)} pips`;
                document.getElementById('eur-change').textContent = `Change: ${change >= 0 ? '+' : ''}${(change * 10000).toFixed(1)} pips`;
                document.getElementById('eur-trend').textContent = trend;
                
                lastPrices.eur = eur.bid;
            }

            // GBP/USD
            const gbp = data.live_rates.GBPUSD;
            if (gbp) {
                const change = lastPrices.gbp ? gbp.bid - lastPrices.gbp : 0;
                const trend = change > 0 ? 'üìà' : change < 0 ? 'üìâ' : '‚û°Ô∏è';
                
                document.getElementById('gbp-price').textContent = gbp.bid.toFixed(5);
                document.getElementById('gbp-spread').textContent = `Spread: ${(gbp.spread * 10000).toFixed(1)} pips`;
                document.getElementById('gbp-change').textContent = `Change: ${change >= 0 ? '+' : ''}${(change * 10000).toFixed(1)} pips`;
                document.getElementById('gbp-trend').textContent = trend;
                
                lastPrices.gbp = gbp.bid;
            }

            // Update account info
            if (data.account_info) {
                document.getElementById('account-balance').textContent = `$${data.account_info.balance?.toFixed(2)}`;
                document.getElementById('account-info').textContent = 
                    `Account: ${data.account_info.login} | ${data.account_info.server}`;
            }
        }

        function updateIntelligenceSummary(data) {
            // Active edges
            const activeEdges = data.statistical_edges ? 
                Object.values(data.statistical_edges).filter(e => e.is_active).length : 0;
            document.getElementById('active-edges').textContent = activeEdges;

            // Strategy signals
            const signalCount = data.active_signals ? data.active_signals.length : 0;
            document.getElementById('strategy-signals').textContent = signalCount;

            // Live alerts
            const alertCount = data.active_alerts ? data.active_alerts.length : 0;
            document.getElementById('live-alerts').textContent = alertCount;

            // Patterns discovered
            const patternsCount = data.discovered_patterns ? data.discovered_patterns.length : 0;
            document.getElementById('patterns-discovered').textContent = patternsCount;

            // Average confidence
            let avgConfidence = 0;
            if (data.active_signals && data.active_signals.length > 0) {
                avgConfidence = data.active_signals.reduce((sum, signal) => sum + (signal.confidence || 0), 0) / data.active_signals.length;
            }
            document.getElementById('avg-confidence').textContent = `${avgConfidence.toFixed(0)}%`;

            // Risk level
            const goldSpread = data.live_rates?.GOLD?.spread || 0;
            let riskLevel = 'LOW';
            if (goldSpread > 0.8) riskLevel = 'HIGH';
            else if (goldSpread > 0.4) riskLevel = 'MED';
            document.getElementById('risk-level').textContent = riskLevel;
        }

        function updateLiveSignals(data) {
            const container = document.getElementById('live-signals');
            container.innerHTML = '';

            const signals = data.active_signals || [];
            document.getElementById('signal-count').textContent = signals.length;

            if (signals.length === 0) {
                container.innerHTML = '<div class="text-white/60 text-center py-8 col-span-2">No active signals. System monitoring...</div>';
                return;
            }

            signals.slice(0, 4).forEach(signal => {
                const signalDiv = document.createElement('div');
                signalDiv.className = 'glass p-4 card scale-in';
                
                const confidenceColor = signal.confidence >= 80 ? 'text-green-400' : 
                                       signal.confidence >= 60 ? 'text-yellow-400' : 'text-red-400';
                
                signalDiv.innerHTML = `
                    <div class="flex justify-between items-start mb-3">
                        <h4 class="font-bold text-white">${signal.strategy || 'Strategy'}</h4>
                        <div class="${confidenceColor} font-bold">${signal.confidence?.toFixed(0)}%</div>
                    </div>
                    <div class="mb-2">
                        <span class="px-2 py-1 rounded text-sm font-bold ${
                            signal.signal_type === 'BUY' ? 'bg-green-500/20 text-green-400' : 'bg-red-500/20 text-red-400'
                        }">${signal.signal_type}</span>
                        <span class="text-white ml-2">${signal.symbol} @ $${signal.price?.toFixed(2)}</span>
                    </div>
                    <div class="text-sm text-white/80 mb-2">${signal.reasoning || 'High probability setup'}</div>
                    <div class="flex justify-between text-xs text-white/60">
                        <span>Risk: ${signal.risk_level}</span>
                        <span>SL: $${signal.stop_loss?.toFixed(2)}</span>
                        <span>TP: $${signal.take_profit?.toFixed(2)}</span>
                    </div>
                `;
                
                container.appendChild(signalDiv);
            });
        }

        function updateStrategyMatrix(data) {
            const container = document.getElementById('strategy-matrix');
            container.innerHTML = '';

            const strategies = data.strategy_performance || {};

            if (Object.keys(strategies).length === 0) {
                container.innerHTML = '<div class="glass p-8 text-center text-white/60 col-span-5">Loading strategies...</div>';
                return;
            }

            Object.values(strategies).forEach(strategy => {
                const card = document.createElement('div');
                card.className = 'glass p-4 card fade-in';
                
                let performanceClass = 'performance-average';
                if (strategy.win_rate >= 70) performanceClass = 'performance-excellent';
                else if (strategy.win_rate >= 60) performanceClass = 'performance-good';
                else if (strategy.win_rate < 40) performanceClass = 'performance-poor';
                
                const statusIcon = strategy.is_active ? 'üü¢' : 'üî¥';
                const trendIcon = strategy.current_streak > 0 ? 'üìà' : 
                                strategy.current_streak < 0 ? 'üìâ' : '‚û°Ô∏è';
                
                card.innerHTML = `
                    <div class="flex justify-between items-start mb-3">
                        <h4 class="font-bold text-white text-sm">${strategy.name}</h4>
                        <span class="text-lg">${statusIcon}</span>
                    </div>
                    <div class="mb-3">
                        <div class="text-2xl font-bold text-white">${strategy.win_rate?.toFixed(0) || 0}%</div>
                        <div class="text-xs text-white/60">Win Rate</div>
                    </div>
                    <div class="space-y-1 text-xs">
                        <div class="flex justify-between">
                            <span class="text-white/60">Signals:</span>
                            <span class="text-white">${strategy.total_signals || 0}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-white/60">Streak:</span>
                            <span class="text-white">${trendIcon} ${Math.abs(strategy.current_streak || 0)}</span>
                        </div>
                    </div>
                    <div class="mt-3 w-full bg-white/10 rounded-full h-2">
                        <div class="${performanceClass} h-2 rounded-full transition-all duration-500" 
                             style="width: ${strategy.performance_score || 0}%"></div>
                    </div>
                `;
                
                container.appendChild(card);
            });
        }

        function updateStatisticalAnalysis(data) {
            const container = document.getElementById('statistical-analysis');
            container.innerHTML = '';

            const edges = data.statistical_edges || {};
            const activeEdges = Object.entries(edges).filter(([_, edge]) => edge.is_active);

            if (activeEdges.length === 0) {
                container.innerHTML = '<div class="text-white/60 text-center py-4">Scanning for statistical patterns...</div>';
                return;
            }

            activeEdges.slice(0, 5).forEach(([key, edge]) => {
                const edgeDiv = document.createElement('div');
                edgeDiv.className = 'glass p-3 fade-in';
                
                const strengthColor = edge.strength >= 70 ? 'text-green-400' : 
                                    edge.strength >= 50 ? 'text-yellow-400' : 'text-orange-400';
                
                edgeDiv.innerHTML = `
                    <div class="flex justify-between items-center">
                        <div>
                            <h4 class="font-semibold text-white text-sm">${edge.name}</h4>
                            <div class="text-xs text-white/60">${edge.type.replace('_', ' ')} ‚Ä¢ ${edge.period}</div>
                        </div>
                        <div class="text-right">
                            <div class="${strengthColor} font-bold">${edge.strength?.toFixed(0)}%</div>
                            <div class="text-xs text-white/60">${edge.win_rate?.toFixed(1)}% WR</div>
                        </div>
                    </div>
                `;
                
                container.appendChild(edgeDiv);
            });
        }

        function updatePatternDiscovery(data) {
            const container = document.getElementById('pattern-discovery');
            container.innerHTML = '';

            const patterns = data.discovered_patterns || [];

            if (patterns.length === 0) {
                container.innerHTML = '<div class="text-white/60 text-center py-4">AI pattern discovery in progress...</div>';
                return;
            }

            patterns.slice(0, 5).forEach(pattern => {
                const patternDiv = document.createElement('div');
                const validationClass = pattern.is_validated ? 'pattern-validated' : 'pattern-pending';
                patternDiv.className = `glass p-3 ${validationClass} scale-in`;
                
                patternDiv.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <h4 class="font-semibold text-white text-sm">${pattern.name}</h4>
                            <div class="text-xs text-white/60 mt-1">${pattern.type} ‚Ä¢ ${pattern.total_occurrences} samples</div>
                        </div>
                        <div class="text-right">
                            <div class="text-sm font-bold ${pattern.is_validated ? 'text-green-400' : 'text-yellow-400'}">
                                ${pattern.validation_score?.toFixed(0)}%
                            </div>
                            <div class="text-xs text-white/60">
                                ${pattern.is_validated ? 'Validated' : 'Pending'}
                            </div>
                        </div>
                    </div>
                `;
                
                container.appendChild(patternDiv);
            });
        }

        function updateMarketIntelligence(data) {
            // Market regime
            const goldPrice = data.live_rates?.GOLD?.bid || 0;
            const spread = data.live_rates?.GOLD?.spread || 0;
            
            let regime = 'Ranging';
            let confidence = 'Medium';
            
            if (spread > 0.6) {
                regime = 'High Volatility';
                confidence = 'High';
            } else if (goldPrice > 3400) {
                regime = 'Bull Market';
                confidence = 'High';
            } else if (goldPrice < 3300) {
                regime = 'Bear Market';
                confidence = 'High';
            }
            
            document.getElementById('market-regime').textContent = regime;
            document.getElementById('regime-confidence').textContent = `${confidence} confidence`;

            // Volatility
            const volatility = spread > 0.6 ? 'HIGH' : spread > 0.3 ? 'MEDIUM' : 'LOW';
            document.getElementById('volatility-status').textContent = volatility;
            document.getElementById('volatility-details').textContent = `Spread: ${spread.toFixed(2)}`;

            // Session
            const currentHour = new Date().getHours();
            let session = 'Quiet Period';
            let sessionDetails = 'Low activity expected';
            
            if (8 <= currentHour <= 17) {
                session = 'European';
                sessionDetails = 'London session active';
            }
            if (13 <= currentHour <= 22) {
                session = 'US Session';
                sessionDetails = 'New York active';
            }
            if (13 <= currentHour <= 16) {
                session = 'Major Overlap';
                sessionDetails = 'London + NY overlap';
            }
            
            document.getElementById('current-session').textContent = session;
            document.getElementById('session-details').textContent = sessionDetails;

            // Opportunity score
            let opportunityScore = 50; // Base score
            
            // Add points for active edges
            const activeEdges = data.statistical_edges ? 
                Object.values(data.statistical_edges).filter(e => e.is_active).length : 0;
            opportunityScore += activeEdges * 5;
            
            // Add points for high confidence signals
            if (data.active_signals) {
                const highConfSignals = data.active_signals.filter(s => s.confidence >= 80).length;
                opportunityScore += highConfSignals * 10;
            }
            
            // Add points for major session overlap
            if (13 <= currentHour <= 16) opportunityScore += 15;
            
            // Subtract points for high volatility
            if (spread > 0.6) opportunityScore -= 10;
            
            opportunityScore = Math.max(0, Math.min(100, opportunityScore));
            
            document.getElementById('opportunity-score').textContent = opportunityScore.toFixed(0);
        }

        function updateCriticalAlerts(data) {
            const criticalAlerts = data.active_alerts ? 
                data.active_alerts.filter(alert => alert.priority >= 4) : [];
            
            if (criticalAlerts.length > 0) {
                const alert = criticalAlerts[0]; // Show first critical alert
                document.getElementById('critical-alert-message').textContent = alert.message;
                document.getElementById('critical-alerts-banner').classList.remove('hidden');
            }
        }

        function dismissCriticalAlert() {
            document.getElementById('critical-alerts-banner').classList.add('hidden');
        }

        // Start the ultimate dashboard
        connectWebSocket();
        
        // Update server time every second
        setInterval(updateServerTime, 1000);
        
        console.log('üöÄ Ultimate MT5 Trading Intelligence Platform Loaded');
        console.log('üìä Features: Real-time data, Statistical edges, Strategy monitoring, Pattern discovery, Smart alerts');
    </script>
</body>
</html>